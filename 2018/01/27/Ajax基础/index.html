<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Ajax基础 · Lucky4</title><meta name="description" content="Ajax基础 - Lucky4"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Lucky4"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Ajax基础</h1><div class="post-info">Jan 27, 2018</div><div class="post-content"><h2 id="什么是Ajax？"><a href="#什么是Ajax？" class="headerlink" title="什么是Ajax？"></a>什么是Ajax？</h2><blockquote>
<p>Ajax全称为”Asynchronous JavaScript and XML”(异步的JavaScript和XML),Ajax的核心是XMLHttpRequest对象，它可以和服务器进行通信，发送异步请求，接收服务器发来的数据。其中数据的格式可以包括JSON, XML, HTML和文本等格式。</p>
</blockquote>
<p>Ajax的优势：</p>
<ol>
<li><p>不需插件支持<br>Ajax不需要任何浏览器插件，就可以被浏览器所支持。</p>
</li>
<li><p>优秀的用户体验<br>能在不刷新整个页面的前提下更新数据。</p>
</li>
<li><p>提高Web程序的性能<br>传统模式中，数据的提交是通过表单来实现的，而数据获取是靠全页面刷新来重新获取整个页面内容。Ajax只是通过XMLHttpRequest对象向服务器端提交希望提交的数据。</p>
</li>
<li><p>减轻服务器和宽带的负担<br>Ajax的工作原理相当于在用户和服务器之间加了一个中间层，使用户操作与服务器响应异步化。它在客户端创建Ajax引擎，把传统方式下的一些服务器负担的工作转移到客户端。</p>
</li>
</ol>
<p>Ajax的不足</p>
<ol>
<li>浏览器对XMLHttpRequest对象的支持度不足</li>
<li>对搜索引擎的支持的不足</li>
<li>开发和调试工具的缺乏</li>
</ol>
<h2 id="核心-XMLHttpRequest"><a href="#核心-XMLHttpRequest" class="headerlink" title="核心:XMLHttpRequest"></a>核心:XMLHttpRequest</h2><p>解释：</p>
<blockquote>
<p>XMLHttpRequest 是一个 API，它为客户端提供了在客户端和服务器之间传输数据的功能。它提供了一个通过 URL 来获取数据的简单方式，并且不会使整个页面刷新。这使得网页只更新一部分页面而不会打扰到用户。XMLHttpRequest 在 AJAX 中被大量使用。</p>
</blockquote>
<p>历史：</p>
<blockquote>
<p>XMLHttpRequest 最初由微软设计，随后被 Mozilla、Apple 和 Google采纳。如今，该对象已经被 W3C组织标准化。 通过它，你可以很容易的取回一个 URL 上的资源数据。尽管名字里有 XML，但 XMLHttpRequest 可以取回所有类型的数据资源，并不局限于 XML。而且除了 HTTP ，它还支持 file 和 ftp 协议。</p>
</blockquote>
<p>构造函数:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">XMLHttpRequest()</div></pre></td></tr></table></figure></p>
<p>常用属性：</p>
<ol>
<li><p>onreadystatechange<br>一个方法（回调函数），当readyState属性改变时会调用它。</p>
</li>
<li><p>readyState<br>一个整型数字，代表请求的5种状态。<br>值&emsp;&emsp;状态&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;描述<br>0&emsp;&emsp;UNSENT（未打开）&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;open()方法还未被调用<br>1&emsp;&emsp;OPENED（未发送）&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;open()方法已被调用<br>2&emsp;&emsp;HEADERS_RECEIVED（以获取响应头）&emsp;send()方法已被调用，响应头和响应状态已经返回<br>3&emsp;&emsp;LOADING（正在下载响应体）&emsp;&emsp;&emsp;&emsp;&emsp;响应体下载中；responseText中已经获取了部分数据<br>4&emsp;&emsp;DONE（请求完成）&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;整个请求过程已经完毕</p>
</li>
<li><p>response<br>响应实体，多种类型，失败为null。</p>
</li>
<li><p>responseText<br>响应实体为文本,失败为null。</p>
</li>
<li><p>responseType<br>期待响应的类型。</p>
</li>
<li><p>responseXML<br>响应的类型是Document。</p>
</li>
<li><p>status<br>响应的状态码。</p>
</li>
<li><p>statusText<br>响应的状态信息。</p>
</li>
<li><p>timeout<br>代表着一个请求在被自动终止前所消耗的毫秒数。</p>
</li>
</ol>
<p>常用方法:</p>
<ol>
<li><p>abort()<br>请求被发送后（send方法调用后），终止请求。</p>
</li>
<li><p>open(method, url, async, user, password)<br>初始化请求。（method必须为大写）</p>
</li>
<li><p>send(body)<br>发送请求,请求为异步的话方法会立刻返回，请求为同步的话方法会等到响应到达时返回。body为发送内容。</p>
</li>
<li><p>setRequestHeader(header, value)<br>设置请求的header，使用原生ajax的时候，发送请求需要设置的包括Access-Control-Allow-Origin，Content-Type头信息。</p>
</li>
</ol>
<p>事件接口：</p>
<ol>
<li><p>loadstart<br>Progress has begun.</p>
</li>
<li><p>progress<br>In progress.</p>
</li>
<li><p>error<br>Progression failed.</p>
</li>
<li><p>abort<br>Progression is terminated.</p>
</li>
<li><p>timeout<br>Progression is terminated due to preset time expiring.</p>
</li>
<li><p>load<br>Progression is successful.</p>
</li>
<li><p>loadend<br>Progress has stopped.</p>
<h2 id="使用XMLHttpRequest对象发送Ajax请求的基本步骤"><a href="#使用XMLHttpRequest对象发送Ajax请求的基本步骤" class="headerlink" title="使用XMLHttpRequest对象发送Ajax请求的基本步骤"></a>使用XMLHttpRequest对象发送Ajax请求的基本步骤</h2></li>
<li>创建XMLHttpRequest对象。</li>
<li>告诉XMLHttpRequest对象由哪一个函数处理响应。</li>
<li>使用XMLHttpRequest对象的open方法，设置请求类型，请求地址以及是否采用异步。</li>
<li>使用XMLHttpRequest对象的send方法，方法的参数是任何想要发送的内容。如果是GET请求，那么send方法的参数为null；如果是POST请求，那么需要在发送请求前设置请求的MIME类型。</li>
</ol>
<h2 id="简单例子"><a href="#简单例子" class="headerlink" title="简单例子"></a>简单例子</h2><p>这个Ajax例子是一个输入框，输入省份的首字母，在输入框下面会显示省份的所有城市。<br>这里采用了mock的方式生成城市的数据，为了以后扩展扩展这个应用，我们使用模块化的方式编写。</p>
<p>项目目录：<br>dist<br>&nbsp;&nbsp;&nbsp;&nbsp;bundle.js<br>mock<br>&nbsp;&nbsp;&nbsp;&nbsp;data.js<br>src<br>&nbsp;&nbsp;&nbsp;&nbsp;search.js<br>index.html<br>package.json<br>webpack.config.js</p>
<h4 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a>index.html</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html lang=&quot;en&quot;&gt;</div><div class="line">&lt;head&gt;</div><div class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</div><div class="line">  &lt;title&gt;Ajax-Search&lt;/title&gt;</div><div class="line">  &lt;style&gt;</div><div class="line">    .container &#123;</div><div class="line">      overflow: hidden;</div><div class="line">      width: 100%;</div><div class="line">    &#125;</div><div class="line">  &lt;/style&gt;</div><div class="line">&lt;/head&gt;</div><div class="line"></div><div class="line">&lt;body&gt;</div><div class="line">&lt;div class=&quot;container&quot; id=&quot;container&quot;&gt;</div><div class="line">  &lt;input type=&quot;search&quot; id=&quot;province&quot; /&gt;</div><div class="line">  &lt;div id=&quot;city-container&quot;&gt;&lt;/div&gt;</div><div class="line">&lt;/div&gt;</div><div class="line">&lt;/body&gt;</div><div class="line"></div><div class="line">&lt;script src=&quot;./dist/bundle.js&quot;&gt;&lt;/script&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<h4 id="data-js"><a href="#data-js" class="headerlink" title="data.js"></a>data.js</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">var Mock = require(&apos;mockjs&apos;);</div><div class="line"></div><div class="line">var HLJ = Mock.mock(/hlj\.json/, &#123;</div><div class="line">  &apos;city&apos;: &#123;</div><div class="line">    &apos;110000&apos;: &apos;哈尔滨市&apos;,</div><div class="line">    &apos;110001&apos;: &apos;齐齐哈尔市&apos;</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">var LN = Mock.mock(/ln\.json/, &#123;</div><div class="line">  &apos;city&apos;: &#123;</div><div class="line">    &apos;220000&apos;: &apos;沈阳市&apos;,</div><div class="line">    &apos;220001&apos;: &apos;大连市&apos;</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">var JL = Mock.mock(/jl\.json/, &#123;</div><div class="line">  &apos;city&apos;: &#123;</div><div class="line">    &apos;330000&apos;: &apos;长春市&apos;,</div><div class="line">    &apos;330001&apos;: &apos;吉林市&apos;</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">var ZJ = Mock.mock(/zj\.json/, &#123;</div><div class="line">  &apos;city&apos;: &#123;</div><div class="line">    &apos;440000&apos;: &apos;杭州市&apos;,</div><div class="line">    &apos;440001&apos;: &apos;舟山市&apos;</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">var GZ = Mock.mock(/gz\.json/, &#123;</div><div class="line">  &apos;city&apos;: &#123;</div><div class="line">    &apos;550000&apos;: &apos;广州市&apos;,</div><div class="line">    &apos;550001&apos;: &apos;惠州市&apos;</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">module.exports = &#123;</div><div class="line">  HLJ,</div><div class="line">  LN,</div><div class="line">  JL,</div><div class="line">  ZJ,</div><div class="line">  GZ</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="search-js"><a href="#search-js" class="headerlink" title="search.js"></a>search.js</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">require(&apos;../mock/data&apos;);</div><div class="line"></div><div class="line">var httpRequest = null;</div><div class="line">var containerElem = document.getElementById(&apos;city-container&apos;);</div><div class="line">var inputElem = document.getElementById(&apos;province&apos;);</div><div class="line">inputElem.addEventListener(&apos;input&apos;, getCity);</div><div class="line"></div><div class="line">function getCity(e) &#123;</div><div class="line">  var province = e.target.value;</div><div class="line">  makeRequest(province);</div><div class="line">&#125;</div><div class="line"></div><div class="line">function makeRequest(keyword) &#123;</div><div class="line">  if (window.XMLHttpRequest) &#123;</div><div class="line">    httpRequest = new XMLHttpRequest();</div><div class="line">  &#125; else if (window.ActiveXObject) &#123;</div><div class="line">    httpRequest = new ActiveXObject();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  if (!httpRequest) &#123;</div><div class="line">    alert(&apos;Giving up : Cannot create an XMLHTTP instance&apos;);</div><div class="line">    return false;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  httpRequest.onreadystatechange = resolve;</div><div class="line">  httpRequest.open(&apos;GET&apos;, keyword + &apos;.json&apos;, true);</div><div class="line">  httpRequest.send(null);</div><div class="line">&#125;</div><div class="line"></div><div class="line">function resolve() &#123;</div><div class="line">  var cityContainerElem = document.createElement(&apos;ul&apos;);</div><div class="line">  var cityData = null;</div><div class="line">  var cityElem = null;</div><div class="line">  var city = &apos;no data&apos;;</div><div class="line"></div><div class="line">  if (httpRequest.readyState === XMLHttpRequest.DONE) &#123;</div><div class="line">    if (httpRequest.status === 200) &#123;</div><div class="line">      cityData = JSON.parse(httpRequest.responseText).city;</div><div class="line">      for (var item in cityData) &#123;</div><div class="line">        city = document.createTextNode(cityData[item]);</div><div class="line">        cityElem = document.createElement(&apos;li&apos;);</div><div class="line">        cityElem.appendChild(city);</div><div class="line">        cityContainerElem.appendChild(cityElem);</div><div class="line">      &#125;</div><div class="line">    &#125; else if (httpRequest.status === 404) &#123;</div><div class="line">      city = document.createTextNode(city);</div><div class="line">      cityElem = document.createElement(&apos;li&apos;);</div><div class="line">      cityElem.appendChild(city);</div><div class="line">      cityContainerElem.appendChild(cityElem);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (containerElem.childNodes.length !== 0) &#123;</div><div class="line">      containerElem.replaceChild(cityContainerElem, containerElem.firstChild);</div><div class="line">    &#125; else &#123;</div><div class="line">      containerElem.appendChild(cityContainerElem);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>参考：<br><a href="https://developer.mozilla.org/en-US/docs/Web/Guide/AJAX" target="_blank" rel="external">https://developer.mozilla.org/en-US/docs/Web/Guide/AJAX</a><br>《锋利的JQuery》</p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/01/08/babel学习/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://yoursite.com">Lucky4</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>